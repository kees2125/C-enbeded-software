<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
    <title>Nut/OS API</title>
    <link href="nut_en.css" rel="stylesheet" type="text/css">
</head>
<body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">ethernut-4.3.3</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_000001.html">nut</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_000031.html">dev</a></div>
<h1>twbbif.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
Bit banging two wire interface. 
<p>
Tested with AT91R40008 only. Other ARMs or AVR may not work.<p>
<div class="fragment"><pre class="fragment"> *
 * $Log: twbbif.c,v $
 * Revision 1.7  2007/02/15 16:25:40  haraldkipp
 * Configurable port bits. Should work now on all AT91 MCUs.
 *
 * Revision 1.6  2006/10/08 16:48:09  haraldkipp
 * Documentation fixed
 *
 * Revision 1.5  2006/06/28 17:10:35  haraldkipp
 * Include more general header file for ARM.
 *
 * Revision 1.4  2006/05/25 09:30:23  haraldkipp
 * Compiles for AVR. Still not tested, though.
 *
 * Revision 1.3  2006/04/07 12:50:20  haraldkipp
 * Added additional delays in TwAck.
 * Clock and data forced to high before switching to input gives better
 * waveforms.
 * Additional delay added to set clock to 50% duty cycle. The PCF8563
 * seems to fail, if the clock's high time is much longer than the low time.
 *
 * Revision 1.2  2006/01/23 17:32:35  haraldkipp
 * Automatic initialization added.
 *
 * Revision 1.1  2005/10/24 10:21:57  haraldkipp
 * Initial check in.
 *
 *
 * </pre></div>
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twbbif_8c.html#a8">TwMasterTransact</a> (u_char sla, CONST void *txdata, <a class="el" href="group__xgNutOS.html#ga1">u_short</a> txlen, void *rxdata, <a class="el" href="group__xgNutOS.html#ga1">u_short</a> rxsiz, <a class="el" href="group__xgNutOS.html#ga3">u_long</a> tmo)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Transmit and/or receive data as a master.  <a href="#a8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twbbif_8c.html#a9">TwMasterError</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get last master mode error.  <a href="#a9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twbbif_8c.html#a10">TwSlaveListen</a> (u_char *sla, void *rxdata, <a class="el" href="group__xgNutOS.html#ga1">u_short</a> rxsiz, <a class="el" href="group__xgNutOS.html#ga3">u_long</a> tmo)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Listen for incoming data from a master.  <a href="#a10"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twbbif_8c.html#a11">TwSlaveRespond</a> (void *txdata, <a class="el" href="group__xgNutOS.html#ga1">u_short</a> txlen, <a class="el" href="group__xgNutOS.html#ga3">u_long</a> tmo)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send response to a master.  <a href="#a11"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twbbif_8c.html#a12">TwSlaveError</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get last slave mode error.  <a href="#a12"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twbbif_8c.html#a13">TwIOCtl</a> (int req, void *conf)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Perform TWI control functions.  <a href="#a13"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="twbbif_8c.html#a14">TwInit</a> (u_char sla)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize TWI interface.  <a href="#a14"></a><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a8"></a><!-- doxytag: member="twbbif.c::TwMasterTransact" ref="a8" args="(u_char sla, CONST void *txdata, u_short txlen, void *rxdata, u_short rxsiz, u_long tmo)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int TwMasterTransact           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">u_char&nbsp;</td>
          <td class="mdname" nowrap> <em>sla</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>CONST void *&nbsp;</td>
          <td class="mdname" nowrap> <em>txdata</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="group__xgNutOS.html#ga1">u_short</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>txlen</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>rxdata</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="group__xgNutOS.html#ga1">u_short</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>rxsiz</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="group__xgNutOS.html#ga3">u_long</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>tmo</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Transmit and/or receive data as a master. 
<p>
The two-wire serial interface must have been initialized by calling <a class="el" href="twbbif_8c.html#a14">TwInit()</a> before this function can be used.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sla</em>&nbsp;</td><td>Slave address of the destination. This slave address must be specified as a 7-bit address. For example, the PCF8574A may be configured to slave addresses from 0x38 to 0x3F. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>txdata</em>&nbsp;</td><td>Points to the data to transmit. Ignored, if the number of data bytes to transmit is zero. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>txlen</em>&nbsp;</td><td>Number of data bytes to transmit. If zero, then the interface will not send any data to the slave device and will directly enter the master receive mode. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rxdata</em>&nbsp;</td><td>Points to a buffer, where the received data will be stored. Ignored, if the maximum number of bytes to receive is zero. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rxsiz</em>&nbsp;</td><td>Maximum number of bytes to receive. Set to zero, if no bytes are expected from the slave device. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tmo</em>&nbsp;</td><td>Timeout in milliseconds. To disable timeout, set this parameter to NUT_WAIT_INFINITE.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The number of bytes received, -1 in case of an error or timeout.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>Timeout is not used in the bit banging version.</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a9"></a><!-- doxytag: member="twbbif.c::TwMasterError" ref="a9" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int TwMasterError           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get last master mode error. 
<p>
You may call this function to determine the specific cause of an error after <a class="el" href="twbbif_8c.html#a8">TwMasterTransact()</a> failed.<p>
<dl compact><dt><b>Returns:</b></dt><dd>Error code or 0 if no error occurred.</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a10"></a><!-- doxytag: member="twbbif.c::TwSlaveListen" ref="a10" args="(u_char *sla, void *rxdata, u_short rxsiz, u_long tmo)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int TwSlaveListen           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">u_char *&nbsp;</td>
          <td class="mdname" nowrap> <em>sla</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>rxdata</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="group__xgNutOS.html#ga1">u_short</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>rxsiz</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="group__xgNutOS.html#ga3">u_long</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>tmo</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Listen for incoming data from a master. 
<p>
If this function returns without error, the bus is blocked. The caller must immediately process the request and return a response by calling <a class="el" href="twbbif_8c.html#a11">TwSlaveRespond()</a>.<p>
<dl compact><dt><b>Note:</b></dt><dd>Slave mode is not implemented in the bit banging version. Thus the function always returns -1.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sla</em>&nbsp;</td><td>Points to a byte variable, which receives the slave address sent by the master. This can be used by the caller to determine whether the the interface has been addressed by a general call or its individual address. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rxdata</em>&nbsp;</td><td>Points to a data buffer where the received data bytes are stored. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rxsiz</em>&nbsp;</td><td>Specifies the maximum number of data bytes to receive. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tmo</em>&nbsp;</td><td>Timeout in milliseconds. To disable timeout, set this parameter to NUT_WAIT_INFINITE.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The number of bytes received, -1 in case of an error or timeout.</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a11"></a><!-- doxytag: member="twbbif.c::TwSlaveRespond" ref="a11" args="(void *txdata, u_short txlen, u_long tmo)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int TwSlaveRespond           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname" nowrap> <em>txdata</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="group__xgNutOS.html#ga1">u_short</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>txlen</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="group__xgNutOS.html#ga3">u_long</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>tmo</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Send response to a master. 
<p>
This function must be called as soon as possible after <a class="el" href="twbbif_8c.html#a10">TwSlaveListen()</a> returned successfully, even if no data needs to be returned. Not doing so will completely block the bus.<p>
<dl compact><dt><b>Note:</b></dt><dd>Slave mode is not implemented in the bit banging version. Thus the function always returns -1.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>txdata</em>&nbsp;</td><td>Points to the data to transmit. Ignored, if the number of bytes to transmit is zero. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>txlen</em>&nbsp;</td><td>Number of data bytes to transmit. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tmo</em>&nbsp;</td><td>Timeout in milliseconds. To disable timeout, set this parameter to NUT_WAIT_INFINITE.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The number of bytes transmitted, -1 in case of an error or timeout.</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a12"></a><!-- doxytag: member="twbbif.c::TwSlaveError" ref="a12" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int TwSlaveError           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get last slave mode error. 
<p>
You may call this function to determine the specific cause of an error after <a class="el" href="twbbif_8c.html#a10">TwSlaveListen()</a> or <a class="el" href="twbbif_8c.html#a11">TwSlaveRespond()</a> failed.<p>
<dl compact><dt><b>Returns:</b></dt><dd>Error code or 0 if no error occurred.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>Slave mode is not implemented in the bit banging version. Thus the function always returns TWERR_BUS.</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a13"></a><!-- doxytag: member="twbbif.c::TwIOCtl" ref="a13" args="(int req, void *conf)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int TwIOCtl           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>conf</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Perform TWI control functions. 
<p>
Not implemented in the bit banging version.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>req</em>&nbsp;</td><td>Requested control function. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>conf</em>&nbsp;</td><td>Points to a buffer that contains any data required for the given control function or receives data from that function.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Always 0.</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a14"></a><!-- doxytag: member="twbbif.c::TwInit" ref="a14" args="(u_char sla)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int TwInit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">u_char&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>sla</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initialize TWI interface. 
<p>
The specified slave address is used only, if the local system is running as a slave. Anyway, care must be taken that it doesn't conflict with another connected device.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sla</em>&nbsp;</td><td>Slave address, must be specified as a 7-bit address, always lower than 128.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Always 0.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>Slave mode is not implemented in the bit banging version. Thus the given slave address is ignored.</dd></dl>
    </td>
  </tr>
</table>
<hr>
<address>
  <small>
    &copy;&nbsp;2000-2006 by egnite Software GmbH - 
    visit <a href="http://www.ethernut.de/">http://www.ethernut.de/</a>
  </small>
</address>
</body>
</html>
