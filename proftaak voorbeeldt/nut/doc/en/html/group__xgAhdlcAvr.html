<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
    <title>Nut/OS API</title>
    <link href="nut_en.css" rel="stylesheet" type="text/css">
</head>
<body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>AHDLC<br>
<small>
[<a class="el" href="group__xgNutArchAvrDevSerial.html">Serial</a>]</small>
</h1>
<p>
Collaboration diagram for AHDLC:<center><table><tr><td><img src="group__xgAhdlcAvr.png" border="0" alt="" usemap="#group____xgAhdlcAvr_map">
<map name="group____xgAhdlcAvr_map">
<area href="group__xgNutArchAvrDevSerial.html" shape="rect" coords="19,5,61,26" alt="">
</map></td></tr></table></center>
<hr><a name="_details"></a><h2>Detailed Description</h2>
AHDLC Driver. 
<p>
This code contains a modified UART driver with some speed optimizations for PPP, like table driven FCS calculation. It also implements simple modem handshaking (RTS, CTS and DTR).
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgAhdlcAvr.html#ga27">IN_ACC_MAP</a>(c, m)&nbsp;&nbsp;&nbsp;(( ((u_char) (c)) &lt; 0x20)  &amp;&amp; ((m) &amp; (1UL &lt;&lt; (c))) != 0)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="ga28"></a><!-- doxytag: member="xgAhdlcAvr::NUT_THREAD_AHDLCRXSTACK" ref="ga28" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>NUT_THREAD_AHDLCRXSTACK</b>&nbsp;&nbsp;&nbsp;512</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgAhdlcAvr.html#ga13">AhdlcOutput</a> (<a class="el" href="struct__NUTDEVICE.html">NUTDEVICE</a> *dev, <a class="el" href="struct__NETBUF.html">NETBUF</a> *nb)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send HDLC frame.  <a href="#ga13"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgAhdlcAvr.html#ga14">AhdlcRx</a> (void *arg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Asynchronous HDLC receiver thread.  <a href="#ga14"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgAhdlcAvr.html#ga19">AhdlcAvrIOCtl</a> (<a class="el" href="struct__NUTDEVICE.html">NUTDEVICE</a> *dev, int req, void *conf)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Perform on-chip UART control functions.  <a href="#ga19"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgAhdlcAvr.html#ga20">AhdlcAvrInit</a> (<a class="el" href="struct__NUTDEVICE.html">NUTDEVICE</a> *dev)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize asynchronous HDLC device.  <a href="#ga20"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgAhdlcAvr.html#ga21">AhdlcAvrRead</a> (<a class="el" href="struct__NUTFILE.html">NUTFILE</a> *fp, void *buffer, int size)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read from the asynchronous HDLC device.  <a href="#ga21"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgAhdlcAvr.html#ga22">AhdlcAvrPut</a> (<a class="el" href="struct__NUTDEVICE.html">NUTDEVICE</a> *dev, CONST void *buffer, int len, int pflg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write to the asynchronous HDLC device.  <a href="#ga22"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgAhdlcAvr.html#ga23">AhdlcAvrWrite</a> (<a class="el" href="struct__NUTFILE.html">NUTFILE</a> *fp, CONST void *buffer, int len)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write to the asynchronous HDLC device.  <a href="#ga23"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgAhdlcAvr.html#ga24">AhdlcAvrWrite_P</a> (<a class="el" href="struct__NUTFILE.html">NUTFILE</a> *fp, PGM_P buffer, int len)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write to the asynchronous HDLC device.  <a href="#ga24"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct__NUTFILE.html">NUTFILE</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgAhdlcAvr.html#ga25">AhdlcAvrOpen</a> (<a class="el" href="struct__NUTDEVICE.html">NUTDEVICE</a> *dev, CONST char *name, int mode, int acc)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Open the asynchronous HDLC device.  <a href="#ga25"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgAhdlcAvr.html#ga26">AhdlcAvrClose</a> (<a class="el" href="struct__NUTFILE.html">NUTFILE</a> *fp)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Close the asynchronous HDLC device.  <a href="#ga26"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct__NUTDEVICE.html">NUTDEVICE</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgAhdlcAvr.html#ga1">devAhdlc0</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Device information structure.  <a href="#ga1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct__NUTDEVICE.html">NUTDEVICE</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgAhdlcAvr.html#ga3">devAhdlc1</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Device information structure.  <a href="#ga3"></a><br></td></tr>
</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="ga27"></a><!-- doxytag: member="ahdlcavr.c::IN_ACC_MAP" ref="ga27" args="(c, m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define IN_ACC_MAP          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">c,         <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>m&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(( ((u_char) (c)) &lt; 0x20)  &amp;&amp; ((m) &amp; (1UL &lt;&lt; (c))) != 0)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Checks the 32-bit ACCM to see if the byte needs un-escaping    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="ga13"></a><!-- doxytag: member="ahdlcavr.c::AhdlcOutput" ref="ga13" args="(NUTDEVICE *dev, NETBUF *nb)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int AhdlcOutput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct__NUTDEVICE.html">NUTDEVICE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="struct__NETBUF.html">NETBUF</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>nb</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Send HDLC frame. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Identifies the device to use. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nb</em>&nbsp;</td><td>Network buffer structure containing the packet to be sent. The structure must have been allocated by a previous call <a class="el" href="group__xgnetbuf.html#ga4">NutNetBufAlloc()</a>.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 on success, -1 in case of any errors.</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga14"></a><!-- doxytag: member="ahdlcavr.c::AhdlcRx" ref="ga14" args="(void *arg)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">AhdlcRx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>arg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Asynchronous HDLC receiver thread. 
<p>
Running at high priority.    </td>
  </tr>
</table>
<a class="anchor" name="ga19"></a><!-- doxytag: member="ahdlcavr.c::AhdlcAvrIOCtl" ref="ga19" args="(NUTDEVICE *dev, int req, void *conf)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int AhdlcAvrIOCtl           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct__NUTDEVICE.html">NUTDEVICE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>conf</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Perform on-chip UART control functions. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Identifies the device that receives the device-control function. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>req</em>&nbsp;</td><td>Requested control function. May be set to one of the following constants:<ul>
<li>UART_SETSPEED, conf points to an u_long value containing the baudrate.</li><li>UART_GETSPEED, conf points to an u_long value receiving the current baudrate.</li><li>UART_SETDATABITS, conf points to an u_long value containing the number of data bits, 5, 6, 7 or 8.</li><li>UART_GETDATABITS, conf points to an u_long value receiving the number of data bits, 5, 6, 7 or 8.</li><li>UART_SETPARITY, conf points to an u_long value containing the parity, 0 (no), 1 (odd) or 2 (even).</li><li>UART_GETPARITY, conf points to an u_long value receiving the parity, 0 (no), 1 (odd) or 2 (even).</li><li>UART_SETSTOPBITS, conf points to an u_long value containing the number of stop bits 1 or 2.</li><li>UART_GETSTOPBITS, conf points to an u_long value receiving the number of stop bits 1 or 2.</li><li>UART_SETSTATUS, conf points to an u_long value containing the changes for the control lines.</li><li>UART_GETSTATUS, conf points to an u_long value receiving the state of the control lines and the device.</li><li>UART_SETREADTIMEOUT, conf points to an u_long value containing the read timeout.</li><li>UART_GETREADTIMEOUT, conf points to an u_long value receiving the read timeout.</li><li>UART_SETWRITETIMEOUT, conf points to an u_long value containing the write timeout.</li><li>UART_GETWRITETIMEOUT, conf points to an u_long value receiving the write timeout.</li><li>UART_SETLOCALECHO, conf points to an u_long value containing 0 (off) or 1 (on).</li><li>UART_GETLOCALECHO, conf points to an u_long value receiving 0 (off) or 1 (on).</li><li>UART_SETFLOWCONTROL, conf points to an u_long value containing combined UART_FCTL_ values.</li><li>UART_GETFLOWCONTROL, conf points to an u_long value containing receiving UART_FCTL_ values.</li><li>UART_SETCOOKEDMODE, conf points to an u_long value containing 0 (off) or 1 (on).</li><li>UART_GETCOOKEDMODE, conf points to an u_long value receiving 0 (off) or 1 (on).</li><li>UART_SETRAWMODE, conf points to an u_long value containing 0 (off) or 1 (on).</li><li>UART_GETRAWMODE, conf points to an u_long value receiving 0 (off) or 1 (on).</li><li>HDLC_SETIFNET, conf points to a pointer containing the address of the network device's NUTDEVICE structure.</li><li>HDLC_GETIFNET, conf points to a pointer receiving the address of the network device's NUTDEVICE structure.</li></ul>
</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>conf</em>&nbsp;</td><td>Points to a buffer that contains any data required for the given control function or receives data from that function. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 on success, -1 otherwise.</dd></dl>
<dl compact><dt><b>Warning:</b></dt><dd>Timeout values are given in milliseconds and are limited to the granularity of the system timer.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>For ATmega103, only 8 data bits, 1 stop bit and no parity are allowed.</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga20"></a><!-- doxytag: member="ahdlcavr.c::AhdlcAvrInit" ref="ga20" args="(NUTDEVICE *dev)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int AhdlcAvrInit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct__NUTDEVICE.html">NUTDEVICE</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dev</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initialize asynchronous HDLC device. 
<p>
This function will be called during device registration. It initializes the hardware, registers all required interrupt handlers and initializes all internal data structures used by this driver.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Identifies the device to initialize.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 on success, -1 otherwise.</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga21"></a><!-- doxytag: member="ahdlcavr.c::AhdlcAvrRead" ref="ga21" args="(NUTFILE *fp, void *buffer, int size)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int AhdlcAvrRead           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct__NUTFILE.html">NUTFILE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>fp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>size</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Read from the asynchronous HDLC device. 
<p>
This function is called by the low level input routines of the <a class="el" href="group__xgCrtLowio.html#xrCrtLowio">C runtime library</a>, using the <a class="el" href="struct__NUTDEVICE.html#o9">_NUTDEVICE::dev_read</a> entry.<p>
The function may block the calling thread until at least one character has been received or a timeout occurs.<p>
It is recommended to set a proper read timeout with software handshake. In this case a timeout may occur, if the communication peer lost our last XON character. The application may then use ioctl() to disable the receiver and do the read again. This will send out another XON.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fp</em>&nbsp;</td><td>Pointer to a <a class="el" href="struct__NUTFILE.html">_NUTFILE</a> structure, obtained by a previous call to AhdlcOpen(). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buffer</em>&nbsp;</td><td>Pointer to the buffer that receives the data. If zero, then all characters in the input buffer will be removed. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>Maximum number of bytes to read.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The number of bytes read, which may be less than the number of bytes specified. A return value of -1 indicates an error, while zero is returned in case of a timeout.</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga22"></a><!-- doxytag: member="ahdlcavr.c::AhdlcAvrPut" ref="ga22" args="(NUTDEVICE *dev, CONST void *buffer, int len, int pflg)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int AhdlcAvrPut           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct__NUTDEVICE.html">NUTDEVICE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>CONST void *&nbsp;</td>
          <td class="mdname" nowrap> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>pflg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Write to the asynchronous HDLC device. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Pointer to a previously registered NUTDEVICE structure. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buffer</em>&nbsp;</td><td>Pointer the data to write. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>Number of data bytes to write. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pflg</em>&nbsp;</td><td>If this flag is set, then the buffer is located in program space.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The number of bytes written. In case of a write timeout, this may be less than the specified length.</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga23"></a><!-- doxytag: member="ahdlcavr.c::AhdlcAvrWrite" ref="ga23" args="(NUTFILE *fp, CONST void *buffer, int len)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int AhdlcAvrWrite           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct__NUTFILE.html">NUTFILE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>fp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>CONST void *&nbsp;</td>
          <td class="mdname" nowrap> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>len</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Write to the asynchronous HDLC device. 
<p>
This function is called by the low level output routines of the <a class="el" href="group__xgCrtLowio.html#xrCrtLowio">C runtime library</a>, using the <a class="el" href="struct__NUTDEVICE.html#o10">_NUTDEVICE::dev_write</a> entry.<p>
The function may block the calling thread.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fp</em>&nbsp;</td><td>Pointer to a <a class="el" href="struct__NUTFILE.html">_NUTFILE</a> structure, obtained by a previous call to AhldcOpen(). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buffer</em>&nbsp;</td><td>Pointer to the data to be written. If zero, then the output buffer will be flushed. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>Number of bytes to write.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The number of bytes written, which may be less than the number of bytes specified if a timeout occured. A return value of -1 indicates an error.</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga24"></a><!-- doxytag: member="ahdlcavr.c::AhdlcAvrWrite_P" ref="ga24" args="(NUTFILE *fp, PGM_P buffer, int len)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int AhdlcAvrWrite_P           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct__NUTFILE.html">NUTFILE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>fp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>PGM_P&nbsp;</td>
          <td class="mdname" nowrap> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>len</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Write to the asynchronous HDLC device. 
<p>
Similar to AhdlcWrite() except that the data is located in program memory.<p>
This function is called by the low level output routines of the <a class="el" href="group__xgCrtLowio.html#xrCrtLowio">C runtime library</a>, using the <a class="el" href="struct__NUTDEVICE.html#o11">_NUTDEVICE::dev_write_P</a> entry.<p>
The function may block the calling thread.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fp</em>&nbsp;</td><td>Pointer to a NUTFILE structure, obtained by a previous call to AhdlcOpen(). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buffer</em>&nbsp;</td><td>Pointer to the data in program space to be written. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>Number of bytes to write.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The number of bytes written, which may be less than the number of bytes specified if a timeout occured. A return value of -1 indicates an error.</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga25"></a><!-- doxytag: member="ahdlcavr.c::AhdlcAvrOpen" ref="ga25" args="(NUTDEVICE *dev, CONST char *name, int mode, int acc)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="struct__NUTFILE.html">NUTFILE</a>* AhdlcAvrOpen           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct__NUTDEVICE.html">NUTDEVICE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>CONST char *&nbsp;</td>
          <td class="mdname" nowrap> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>acc</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Open the asynchronous HDLC device. 
<p>
This function is called by the low level open routine of the C runtime library, using the <a class="el" href="struct__NUTDEVICE.html#o12">_NUTDEVICE::dev_open</a> entry.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dev</em>&nbsp;</td><td>Pointer to the NUTDEVICE structure. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>Ignored, should point to an empty string. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td>Operation mode. Any of the following values may be or-ed:<ul>
<li><a class="el" href="group__xgCrtLowio.html#ga17">_O_BINARY</a></li><li><a class="el" href="group__xgCrtLowio.html#ga9">_O_RDONLY</a></li><li><a class="el" href="group__xgCrtLowio.html#ga10">_O_WRONLY</a> </li></ul>
</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>acc</em>&nbsp;</td><td>Ignored, should be zero.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Pointer to a NUTFILE structure if successful or NUTFILE_EOF otherwise.</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga26"></a><!-- doxytag: member="ahdlcavr.c::AhdlcAvrClose" ref="ga26" args="(NUTFILE *fp)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int AhdlcAvrClose           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct__NUTFILE.html">NUTFILE</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>fp</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Close the asynchronous HDLC device. 
<p>
This function is called by the low level close routine of the C runtime library, using the <a class="el" href="struct__NUTDEVICE.html#o13">_NUTDEVICE::dev_close</a> entry.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fp</em>&nbsp;</td><td>Pointer to a <a class="el" href="struct__NUTFILE.html">_NUTFILE</a> structure, obtained by a previous call to <a class="el" href="group__xgUsart.html#ga8">UsartOpen()</a>.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 on success or -1 otherwise.</dd></dl>
<dl compact><dt><b><a class="el" href="todo.html#_todo000017">Todo:</a></b></dt><dd>We may support shared open and use dev_irq as an open counter. </dd></dl>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="ga1"></a><!-- doxytag: member="ahdlc0.c::devAhdlc0" ref="ga1" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="struct__NUTDEVICE.html">NUTDEVICE</a> <a class="el" href="group__xgAhdlcAvr.html#ga1">devAhdlc0</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
    0,                          
    {<span class="charliteral">'u'</span>, <span class="charliteral">'a'</span>, <span class="charliteral">'r'</span>, <span class="charliteral">'t'</span>, <span class="charliteral">'0'</span>, 0, 0, 0, 0},      
    <a class="code" href="group__xgDevice.html#ga19">IFTYP_CHAR</a>,                 
    0,                          
    0,                          
    0,                          
    &amp;dcb_ahdlc,                 
    <a class="code" href="group__xgAhdlcAvr.html#ga20">AhdlcAvrInit</a>,               
    <a class="code" href="group__xgAhdlcAvr.html#ga19">AhdlcAvrIOCtl</a>,              
    <a class="code" href="group__xgAhdlcAvr.html#ga21">AhdlcAvrRead</a>,               
    <a class="code" href="group__xgAhdlcAvr.html#ga23">AhdlcAvrWrite</a>,              
    <a class="code" href="group__xgAhdlcAvr.html#ga24">AhdlcAvrWrite_P</a>,            
    <a class="code" href="group__xgAhdlcAvr.html#ga25">AhdlcAvrOpen</a>,               
    <a class="code" href="group__xgAhdlcAvr.html#ga26">AhdlcAvrClose</a>,              
    0                           
}
</pre></div>Device information structure. 
<p>
A pointer to this structure must be passed to <a class="el" href="group__xgDevice.html#ga7">NutRegisterDevice()</a> to bind this device driver to the Nut/OS kernel.    </td>
  </tr>
</table>
<a class="anchor" name="ga3"></a><!-- doxytag: member="ahdlc1.c::devAhdlc1" ref="ga3" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="struct__NUTDEVICE.html">NUTDEVICE</a> <a class="el" href="group__xgAhdlcAvr.html#ga3">devAhdlc1</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
    0,                          
    {<span class="charliteral">'u'</span>, <span class="charliteral">'a'</span>, <span class="charliteral">'r'</span>, <span class="charliteral">'t'</span>, <span class="charliteral">'1'</span>, 0, 0, 0, 0},      
    <a class="code" href="group__xgDevice.html#ga19">IFTYP_CHAR</a>,                 
    1,                          
    0,                          
    0,                          
    &amp;dcb_ahdlc,                 
    <a class="code" href="group__xgAhdlcAvr.html#ga20">AhdlcAvrInit</a>,               
    <a class="code" href="group__xgAhdlcAvr.html#ga19">AhdlcAvrIOCtl</a>,              
    <a class="code" href="group__xgAhdlcAvr.html#ga21">AhdlcAvrRead</a>,               
    <a class="code" href="group__xgAhdlcAvr.html#ga23">AhdlcAvrWrite</a>,              
    <a class="code" href="group__xgAhdlcAvr.html#ga24">AhdlcAvrWrite_P</a>,            
    <a class="code" href="group__xgAhdlcAvr.html#ga25">AhdlcAvrOpen</a>,               
    <a class="code" href="group__xgAhdlcAvr.html#ga26">AhdlcAvrClose</a>,              
    0                           
}
</pre></div>Device information structure. 
<p>
A pointer to this structure must be passed to <a class="el" href="group__xgDevice.html#ga7">NutRegisterDevice()</a> to bind this device driver to the Nut/OS kernel.    </td>
  </tr>
</table>
<hr>
<address>
  <small>
    &copy;&nbsp;2000-2006 by egnite Software GmbH - 
    visit <a href="http://www.ethernut.de/">http://www.ethernut.de/</a>
  </small>
</address>
</body>
</html>
