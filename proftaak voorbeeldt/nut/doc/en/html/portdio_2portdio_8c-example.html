<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
    <title>Nut/OS API</title>
    <link href="nut_en.css" rel="stylesheet" type="text/css">
</head>
<body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>portdio/portdio.c</h1>TCP server for Port D I/O.<p>
Program Ethernut with portdio.hex and enter<p>
telnet x.x.x.x 12345<p>
two times on two command prompts, replacing x.x.x.x with the IP address of your ethernut board. This will start two telnet session.<p>
Enter help for a list of available commands.<p>
Enter query on the first will show the current port status.<p>
Then enter wait on this session, which will hang until the port status changes.<p>
On the second telnet session enter set1 to set the first output bit.<p>
<div class="fragment"><pre class="fragment">
<span class="preprocessor">#define MY_MAC          {0x00,0x06,0x98,0x20,0x00,0x00}</span>
<span class="preprocessor"></span><span class="preprocessor">#define MY_IP           "192.168.192.100"</span>
<span class="preprocessor"></span><span class="preprocessor">#define MY_MASK         "255.255.255.0"</span>
<span class="preprocessor"></span>
<span class="preprocessor">#include &lt;string.h&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="stdio_8h.html">stdio.h</a>&gt;</span>

<span class="preprocessor">#include &lt;dev/board.h&gt;</span>

<span class="preprocessor">#include &lt;<a class="code" href="heap_8h.html">sys/heap.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="thread_8h.html">sys/thread.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="sys_2timer_8h.html">sys/timer.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="socket_8h.html">sys/socket.h</a>&gt;</span>

<span class="preprocessor">#include &lt;<a class="code" href="inet_8h.html">arpa/inet.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="route_8h.html">net/route.h</a>&gt;</span>
<span class="preprocessor">#include &lt;netdb.h&gt;</span>

<span class="preprocessor">#include &lt;<a class="code" href="pro_2dhcp_8h.html">pro/dhcp.h</a>&gt;</span>


<span class="comment">/*</span>
<span class="comment"> * Process client requests.</span>
<span class="comment"> */</span>
<span class="keywordtype">void</span> ProcessRequests(<a name="a263"></a><a class="code" href="group__xgCrtStdio.html#ga0">FILE</a> * stream)
{
    <a name="a264"></a><a class="code" href="group__xgNutOS.html#ga0">u_char</a> buff[128];
    <a class="code" href="group__xgNutOS.html#ga0">u_char</a> *cp;
    <span class="keywordtype">int</span> <a name="_a265"></a><a class="code" href="structstat.html">stat</a> = -1;

    <a name="a266"></a><a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"200 Welcome to portdio. Type help to get help.\r\n"</span>, stream);
    <span class="keywordflow">for</span> (;;) {
        <a name="a267"></a><a class="code" href="group__xgCrtStdio.html#ga11">fflush</a>(stream);

        <span class="comment">/*</span>
<span class="comment">         * Read a line from the client. Ignore</span>
<span class="comment">         * blank lines.</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> (<a name="a268"></a><a class="code" href="group__xgCrtStdio.html#ga13">fgets</a>(buff, <span class="keyword">sizeof</span>(buff), stream) == 0)
            <span class="keywordflow">break</span>;
        <span class="keywordflow">if</span> ((cp = <a name="a269"></a><a class="code" href="group__xgCrtString.html#ga8">strchr</a>(buff, <span class="charliteral">'\r'</span>)) != 0)
            *cp = 0;
        <span class="keywordflow">if</span> ((cp = <a class="code" href="group__xgCrtString.html#ga8">strchr</a>(buff, <span class="charliteral">'\n'</span>)) != 0)
            *cp = 0;
        <span class="keywordflow">if</span> (buff[0] == 0)
            <span class="keywordflow">continue</span>;

        <span class="comment">/*</span>
<span class="comment">         * Memory info.</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> (<a name="a270"></a><a class="code" href="group__xgCrtString.html#ga16">strncmp</a>(buff, <span class="stringliteral">"memory"</span>, <a name="a271"></a><a class="code" href="group__xgCrtString.html#ga14">strlen</a>(buff)) == 0) {
            <a name="a272"></a><a class="code" href="group__xgCrtStdio.html#ga18">fprintf</a>(stream, <span class="stringliteral">"210 %u bytes RAM free\r\n"</span>, (<a name="a273"></a><a class="code" href="group__xgNutOS.html#ga2">u_int</a>)<a name="a274"></a><a class="code" href="group__xgHeap.html#ga8">NutHeapAvailable</a>());
            <span class="keywordflow">continue</span>;
        }

        <span class="comment">/*</span>
<span class="comment">         * List threads.</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> (<a class="code" href="group__xgCrtString.html#ga16">strncmp</a>(buff, <span class="stringliteral">"threads"</span>, <a class="code" href="group__xgCrtString.html#ga14">strlen</a>(buff)) == 0) {
            <a name="_a275"></a><a class="code" href="struct__NUTTHREADINFO.html">NUTTHREADINFO</a> *tdp;
            <a name="_a276"></a><a class="code" href="struct__NUTTIMERINFO.html">NUTTIMERINFO</a> *tnp;

            <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"220 List of threads with name,state,prio,stack,mem,timeout follows\r\n"</span>, stream);
            <span class="keywordflow">for</span> (tdp = <a name="a277"></a><a class="code" href="group__xgThread.html#ga3">nutThreadList</a>; tdp; tdp = tdp-&gt;<a name="a278"></a><a class="code" href="struct__NUTTHREADINFO.html#o0">td_next</a>) {
                <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(tdp-&gt;<a name="a279"></a><a class="code" href="struct__NUTTHREADINFO.html#o3">td_name</a>, stream);
                <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"\t"</span>, stream);
                <span class="keywordflow">switch</span> (tdp-&gt;<a name="a280"></a><a class="code" href="struct__NUTTHREADINFO.html#o4">td_state</a>) {
                <span class="keywordflow">case</span> <a name="a281"></a><a class="code" href="thread_8h.html#a1">TDS_TERM</a>:
                    <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"\tTerm\t"</span>, stream);
                    <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a name="a282"></a><a class="code" href="thread_8h.html#a2">TDS_RUNNING</a>:
                    <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"\tRun\t"</span>, stream);
                    <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a name="a283"></a><a class="code" href="thread_8h.html#a3">TDS_READY</a>:
                    <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"\tReady\t"</span>, stream);
                    <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> <a name="a284"></a><a class="code" href="thread_8h.html#a4">TDS_SLEEP</a>:
                    <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"\tSleep\t"</span>, stream);
                    <span class="keywordflow">break</span>;
                }
                <a class="code" href="group__xgCrtStdio.html#ga18">fprintf</a>(stream, <span class="stringliteral">"%u\t%u"</span>, tdp-&gt;<a name="a285"></a><a class="code" href="struct__NUTTHREADINFO.html#o6">td_priority</a>, (<a class="code" href="group__xgNutOS.html#ga2">u_int</a>) tdp-&gt;<a name="a286"></a><a class="code" href="struct__NUTTHREADINFO.html#o5">td_sp</a> - (<a class="code" href="group__xgNutOS.html#ga2">u_int</a>) tdp-&gt;<a name="a287"></a><a class="code" href="struct__NUTTHREADINFO.html#o7">td_memory</a>);
                <span class="keywordflow">if</span> (*((<a name="a288"></a><a class="code" href="group__xgNutOS.html#ga3">u_long</a> *) tdp-&gt;<a class="code" href="struct__NUTTHREADINFO.html#o7">td_memory</a>) != DEADBEEF)
                    <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"\tCorrupted\t"</span>, stream);
                <span class="keywordflow">else</span>
                    <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"\tOK\t"</span>, stream);

                <span class="keywordflow">if</span> ((tnp = (<a class="code" href="struct__NUTTIMERINFO.html">NUTTIMERINFO</a> *) tdp-&gt;<a name="a289"></a><a class="code" href="struct__NUTTHREADINFO.html#o8">td_timer</a>) != 0)
                    <a class="code" href="group__xgCrtStdio.html#ga18">fprintf</a>(stream, <span class="stringliteral">"%lu"</span>, tnp-&gt;<a name="a290"></a><a class="code" href="struct__NUTTIMERINFO.html#o3">tn_ticks_left</a>);
                <span class="keywordflow">else</span>
                    <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"None"</span>, stream);
                <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"\r\n"</span>, stream);
            }
            <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">".\r\n"</span>, stream);
            <span class="keywordflow">continue</span>;
        }

        <span class="comment">/*</span>
<span class="comment">         * List timer.</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> (<a class="code" href="group__xgCrtString.html#ga16">strncmp</a>(buff, <span class="stringliteral">"timers"</span>, <a class="code" href="group__xgCrtString.html#ga14">strlen</a>(buff)) == 0) {
            <a class="code" href="struct__NUTTIMERINFO.html">NUTTIMERINFO</a> *tnp;

            <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"221 List of timers with ticks left and interval follows\r\n"</span>, stream);
            <span class="keywordflow">for</span> (tnp = <a name="a291"></a><a class="code" href="group__xgTimer.html#ga0">nutTimerList</a>; tnp; tnp = tnp-&gt;<a name="a292"></a><a class="code" href="struct__NUTTIMERINFO.html#o0">tn_next</a>) {
                <a class="code" href="group__xgCrtStdio.html#ga18">fprintf</a>(stream, <span class="stringliteral">"%lu"</span>, tnp-&gt;<a class="code" href="struct__NUTTIMERINFO.html#o3">tn_ticks_left</a>);
                <span class="keywordflow">if</span> (tnp-&gt;<a name="a293"></a><a class="code" href="struct__NUTTIMERINFO.html#o2">tn_ticks</a>)
                    <a class="code" href="group__xgCrtStdio.html#ga18">fprintf</a>(stream, <span class="stringliteral">"\t%lu\r\n"</span>, tnp-&gt;<a class="code" href="struct__NUTTIMERINFO.html#o2">tn_ticks</a>);
                <span class="keywordflow">else</span>
                    <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"\tOneshot\r\n"</span>, stream);
            }
            <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">".\r\n"</span>, stream);
            <span class="keywordflow">continue</span>;
        }

        <span class="comment">/*</span>
<span class="comment">         * Port status.</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> (<a class="code" href="group__xgCrtString.html#ga16">strncmp</a>(buff, <span class="stringliteral">"query"</span>, <a class="code" href="group__xgCrtString.html#ga14">strlen</a>(buff)) == 0) {
<span class="preprocessor">#ifdef __AVR__</span>
<span class="preprocessor"></span>            stat = inb(PIND);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>            <a class="code" href="group__xgCrtStdio.html#ga18">fprintf</a>(stream, <span class="stringliteral">"210 %02X\r\n"</span>, stat);
            <span class="keywordflow">continue</span>;
        }

        <span class="comment">/*</span>
<span class="comment">         * Reset output bit.</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> (<a class="code" href="group__xgCrtString.html#ga14">strlen</a>(buff) &gt; 1 &amp;&amp; <a class="code" href="group__xgCrtString.html#ga16">strncmp</a>(buff, <span class="stringliteral">"reset"</span>, <a class="code" href="group__xgCrtString.html#ga14">strlen</a>(buff) - 1) == 0) {
            <span class="keywordtype">int</span> mask = 0;
            <span class="keywordflow">switch</span> (buff[<a class="code" href="group__xgCrtString.html#ga14">strlen</a>(buff) - 1]) {
            <span class="keywordflow">case</span> <span class="charliteral">'1'</span>:
                mask = 0x10;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">'2'</span>:
                mask = 0x20;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">'3'</span>:
                mask = 0x40;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">'4'</span>:
                mask = 0x80;
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">if</span> (mask) {
<span class="preprocessor">#ifdef __AVR__</span>
<span class="preprocessor"></span>                outb(PORTD, inb(PORTD) &amp; ~mask);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"210 OK\r\n"</span>, stream);
            } <span class="keywordflow">else</span>
                <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"410 Bad pin\r\n"</span>, stream);
            <span class="keywordflow">continue</span>;
        }

        <span class="comment">/*</span>
<span class="comment">         * Set output bit.</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> (<a class="code" href="group__xgCrtString.html#ga14">strlen</a>(buff) &gt; 1 &amp;&amp; <a class="code" href="group__xgCrtString.html#ga16">strncmp</a>(buff, <span class="stringliteral">"set"</span>, <a class="code" href="group__xgCrtString.html#ga14">strlen</a>(buff) - 1) == 0) {
            <span class="keywordtype">int</span> mask = 0;
            <span class="keywordflow">switch</span> (buff[<a class="code" href="group__xgCrtString.html#ga14">strlen</a>(buff) - 1]) {
            <span class="keywordflow">case</span> <span class="charliteral">'1'</span>:
                mask = 0x10;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">'2'</span>:
                mask = 0x20;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">'3'</span>:
                mask = 0x40;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">'4'</span>:
                mask = 0x80;
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">if</span> (mask) {
<span class="preprocessor">#ifdef __AVR__</span>
<span class="preprocessor"></span>                outb(PORTD, inb(PORTD) | mask);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"210 OK\r\n"</span>, stream);
            } <span class="keywordflow">else</span>
                <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"410 Bad pin\r\n"</span>, stream);
            <span class="keywordflow">continue</span>;
        }

        <span class="comment">/*</span>
<span class="comment">         * wait for status change.</span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> (<a class="code" href="group__xgCrtString.html#ga16">strncmp</a>(buff, <span class="stringliteral">"wait"</span>, <a class="code" href="group__xgCrtString.html#ga14">strlen</a>(buff)) == 0) {
<span class="preprocessor">#ifdef __AVR__</span>
<span class="preprocessor"></span>            <span class="keywordflow">while</span> (stat == inb(PIND))
                <a name="a294"></a><a class="code" href="group__xgThread.html#ga9">NutThreadYield</a>();
            stat = inb(PIND);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>            <a class="code" href="group__xgCrtStdio.html#ga18">fprintf</a>(stream, <span class="stringliteral">"210 %02X\r\n"</span>, stat);
            <span class="keywordflow">continue</span>;
        }

        <span class="comment">/*</span>
<span class="comment">         * Help.</span>
<span class="comment">         */</span>
        <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"400 List of commands follows\r\n"</span>, stream);
        <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"memory\tQueries number of RAM bytes free\r\n"</span>, stream);
        <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"query\tQuery digital i/o status\r\n"</span>, stream);
        <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"reset#\tSet output bit 1..4 low\r\n"</span>, stream);
        <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"set#\tSet output bit 1..4 high\r\n"</span>, stream);
        <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"threads\tLists all created threads\r\n"</span>, stream);
        <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"timers\tLists all running timers\r\n"</span>, stream);
        <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">"wait\tWaits for digital i/o change\r\n"</span>, stream);
        <a class="code" href="group__xgCrtStdio.html#ga22">fputs</a>(<span class="stringliteral">".\r\n"</span>, stream);
    }
}

<span class="comment">/*</span>
<span class="comment"> * Init Port D</span>
<span class="comment"> */</span>
<span class="keywordtype">void</span> init_dio(<span class="keywordtype">void</span>)
{
<span class="preprocessor">#ifdef __AVR__</span>
<span class="preprocessor"></span>    <span class="comment">/*</span>
<span class="comment">     * Upper four pins are output pins.</span>
<span class="comment">     */</span>
    outb(DDRD, 0xf0);

    <span class="comment">/*</span>
<span class="comment">     * Outputs to low and inputs pulled up.</span>
<span class="comment">     */</span>
    outb(PORTD, 0x0f);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}

<span class="keywordtype">void</span> service(<span class="keywordtype">void</span>)
{
    <a name="_a295"></a><a class="code" href="structtcp__socket.html">TCPSOCKET</a> *sock;
    <a class="code" href="group__xgCrtStdio.html#ga0">FILE</a> *stream;

    <span class="comment">/*</span>
<span class="comment">     * Loop endless for connections.</span>
<span class="comment">     */</span>
    <span class="keywordflow">for</span> (;;) {
        <span class="comment">/*</span>
<span class="comment">         * Create a socket.</span>
<span class="comment">         */</span>
        sock = <a name="a296"></a><a class="code" href="group__xgTcpSocket.html#ga7">NutTcpCreateSocket</a>();

        <span class="comment">/*</span>
<span class="comment">         * Listen on port 12345. If we return,</span>
<span class="comment">         * we got a client.</span>
<span class="comment">         */</span>
        <a name="a297"></a><a class="code" href="group__xgTcpSocket.html#ga11">NutTcpAccept</a>(sock, 12345);

        <span class="comment">/*</span>
<span class="comment">         * Create a stream from the socket.</span>
<span class="comment">         */</span>
        stream = <a name="a298"></a><a class="code" href="group__xgCrtStdio.html#ga8">_fdopen</a>((<span class="keywordtype">int</span>) sock, <span class="stringliteral">"r+b"</span>);

        <span class="comment">/*</span>
<span class="comment">         * Process client requests.</span>
<span class="comment">         */</span>
        ProcessRequests(stream);

        <span class="comment">/*</span>
<span class="comment">         * Destroy our device.</span>
<span class="comment">         */</span>
        <a name="a299"></a><a class="code" href="group__xgCrtStdio.html#ga6">fclose</a>(stream);

        <span class="comment">/*</span>
<span class="comment">         * Close our socket.</span>
<span class="comment">         */</span>
        <a name="a300"></a><a class="code" href="group__xgTcpSocket.html#ga14">NutTcpCloseSocket</a>(sock);
    }
}

<a name="a301"></a><a class="code" href="thread_8h.html#a6">THREAD</a>(service_thread, arg)
{
    <span class="keywordflow">for</span> (;;)
        service();
}

<span class="comment">/*</span>
<span class="comment"> * Main application routine. </span>
<span class="comment"> *</span>
<span class="comment"> * Nut/OS automatically calls this entry after initialization.</span>
<span class="comment"> */</span>
<span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)
{
    <a class="code" href="group__xgNutOS.html#ga0">u_char</a> my_mac[] = MY_MAC;

    <span class="comment">/*</span>
<span class="comment">     * Initialize digital I/O.</span>
<span class="comment">     */</span>
    init_dio();

    <span class="comment">/*</span>
<span class="comment">     * Register Realtek controller at address 8300 hex</span>
<span class="comment">     * and interrupt 5.</span>
<span class="comment">     */</span>
    <a name="a302"></a><a class="code" href="group__xgDevice.html#ga7">NutRegisterDevice</a>(&amp;DEV_ETHER, 0x8300, 5);

    <span class="comment">/*</span>
<span class="comment">     * Configure lan interface. </span>
<span class="comment">     */</span>
    <span class="keywordflow">if</span> (<a name="a303"></a><a class="code" href="pro_2dhcp_8h.html#a17">NutDhcpIfConfig</a>(DEV_ETHER_NAME, 0, 60000) &amp;&amp; <a class="code" href="pro_2dhcp_8h.html#a17">NutDhcpIfConfig</a>(<span class="stringliteral">"eth0"</span>, my_mac, 60000)) {
        <span class="comment">/*</span>
<span class="comment">         * No DHCP server available. Use hard coded values.</span>
<span class="comment">         */</span>
        <a class="code" href="group__xgNutOS.html#ga3">u_long</a> ip_addr = <a name="a304"></a><a class="code" href="group__xgIP.html#ga8">inet_addr</a>(MY_IP);      <span class="comment">/* ICCAVR fix. */</span>
        <a name="a305"></a><a class="code" href="group__xgIP.html#ga6">NutNetIfConfig</a>(<span class="stringliteral">"eth0"</span>, my_mac, ip_addr, <a class="code" href="group__xgIP.html#ga8">inet_addr</a>(MY_MASK));
    }

    <span class="comment">/*</span>
<span class="comment">     * Start another service thread to allow</span>
<span class="comment">     * two concurrent connections.</span>
<span class="comment">     */</span>
    <a name="a306"></a><a class="code" href="group__xgNutArchAvrOsContextGcc.html#ga2">NutThreadCreate</a>(<span class="stringliteral">"sback"</span>, service_thread, 0, 1384);

    <span class="keywordflow">for</span> (;;)
        service();
}
</pre></div> <hr>
<address>
  <small>
    &copy;&nbsp;2000-2006 by egnite Software GmbH - 
    visit <a href="http://www.ethernut.de/">http://www.ethernut.de/</a>
  </small>
</address>
</body>
</html>
