<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
    <title>Nut/OS API</title>
    <link href="nut_en.css" rel="stylesheet" type="text/css">
</head>
<body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>threads/threads.c</h1>This sample demonstrates Nut/OS multithreading.<p>
Each thread is started with 192 bytes of stack. This is very low and doesn't provide much space for local variables.<p>
<div class="fragment"><pre class="fragment">
<span class="preprocessor">#include &lt;<a class="code" href="stdio_8h.html">stdio.h</a>&gt;</span>
<span class="preprocessor">#include &lt;io.h&gt;</span>

<span class="preprocessor">#include &lt;cfg/arch.h&gt;</span>
<span class="preprocessor">#include &lt;dev/board.h&gt;</span>

<span class="preprocessor">#include &lt;<a class="code" href="thread_8h.html">sys/thread.h</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="code" href="sys_2timer_8h.html">sys/timer.h</a>&gt;</span>

<span class="comment">/*</span>
<span class="comment"> * High priority thread.</span>
<span class="comment"> */</span>
<a name="a454"></a><a class="code" href="thread_8h.html#a6">THREAD</a>(Thread1, arg)
{
    <span class="comment">/*</span>
<span class="comment">     * Endless loop in high priority thread.</span>
<span class="comment">     */</span>
    <a name="a455"></a><a class="code" href="group__xgThread.html#ga10">NutThreadSetPriority</a>(16);
    <span class="keywordflow">for</span> (;;) {
        <a name="a456"></a><a class="code" href="group__xgCrtStdio.html#ga39">putchar</a>(<span class="charliteral">'H'</span>);
        <a name="a457"></a><a class="code" href="group__xgTimer.html#ga10">NutSleep</a>(125);
    }
}

<span class="comment">/*</span>
<span class="comment"> * Low priority thread.</span>
<span class="comment"> */</span>
<a class="code" href="thread_8h.html#a6">THREAD</a>(Thread2, arg)
{
    <span class="comment">/*</span>
<span class="comment">     * Endless loop in low priority thread.</span>
<span class="comment">     */</span>
    <a class="code" href="group__xgThread.html#ga10">NutThreadSetPriority</a>(128);
    <span class="keywordflow">for</span> (;;) {
        <a class="code" href="group__xgCrtStdio.html#ga39">putchar</a>(<span class="charliteral">'L'</span>);
        <a class="code" href="group__xgTimer.html#ga10">NutSleep</a>(125);
    }
}

<span class="comment">/*</span>
<span class="comment"> * Main application thread. </span>
<span class="comment"> */</span>
<span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)
{
    <a name="a458"></a><a class="code" href="group__xgNutOS.html#ga3">u_long</a> baud = 115200;

    <span class="comment">/*</span>
<span class="comment">     * Register the UART device, open it, assign stdout to it and set </span>
<span class="comment">     * the baudrate.</span>
<span class="comment">     */</span>
    <a name="a459"></a><a class="code" href="group__xgDevice.html#ga7">NutRegisterDevice</a>(&amp;DEV_UART, 0, 0);
    <a name="a460"></a><a class="code" href="group__xgCrtStdio.html#ga25">freopen</a>(DEV_UART_NAME, <span class="stringliteral">"w"</span>, <a name="a461"></a><a class="code" href="group__xgCrtStdio.html#ga66">stdout</a>);
    <a name="a462"></a><a class="code" href="group__xgCrtLowio.html#ga2">_ioctl</a>(<a name="a463"></a><a class="code" href="group__xgCrtStdio.html#ga14">_fileno</a>(<a class="code" href="group__xgCrtStdio.html#ga66">stdout</a>), <a name="a464"></a><a class="code" href="group__xgUARTIOCTL.html#ga0">UART_SETSPEED</a>, &amp;baud);

    <a name="a465"></a><a class="code" href="group__xgCrtStdio.html#ga42">puts</a>(<span class="stringliteral">"\nThread Test"</span>);

    <span class="comment">/*</span>
<span class="comment">     * Start two additional threads. All threads are started with </span>
<span class="comment">     * priority 64.</span>
<span class="comment">     */</span>
    <a name="a466"></a><a class="code" href="group__xgNutArchAvrOsContextGcc.html#ga2">NutThreadCreate</a>(<span class="stringliteral">"t1"</span>, Thread1, 0, 512);
    <a class="code" href="group__xgNutArchAvrOsContextGcc.html#ga2">NutThreadCreate</a>(<span class="stringliteral">"t2"</span>, Thread2, 0, 512);

    <span class="comment">/*</span>
<span class="comment">     * Endless loop in main thread.</span>
<span class="comment">     */</span>
    <span class="keywordflow">for</span> (;;) {
        <a class="code" href="group__xgCrtStdio.html#ga39">putchar</a>(<span class="charliteral">'M'</span>);
        <a class="code" href="group__xgTimer.html#ga10">NutSleep</a>(125);
    }
}
</pre></div> <hr>
<address>
  <small>
    &copy;&nbsp;2000-2006 by egnite Software GmbH - 
    visit <a href="http://www.ethernut.de/">http://www.ethernut.de/</a>
  </small>
</address>
</body>
</html>
